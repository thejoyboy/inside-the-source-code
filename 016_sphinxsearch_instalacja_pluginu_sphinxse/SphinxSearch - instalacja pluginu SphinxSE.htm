<p align="justify">W artykule zatytułowanym <a href="http://inside-the-source-code.blogspot.com/2014/06/sphinxse-sphinx-storage-engine.html">SphinxSE - Sphinx Storage Engine</a> przedstawiony został prosty i szybki sposób rozszerzenia funkcjonalności naszej aplikacji o możliwość wyszukiwania pełnotekstowego (<i>ang. full-text search</i>). Zostało to osiągnięte dzięki wykorzystaniu <i><b>SphinxSE</b></i> czyli opcjonalnemu sposobowi przechowywania wyników wyszukiwania w <i>wirtualnej</i> tabeli, na której można wykonywać operacje typu <i>JOIN</i> z istniejącymi w naszej bazie danych tabelami. Wspomniany na początku artykuł skupia się wyłącznie na składni oraz możliwości zapytań <i>Sphinx Storage Engine</i>, pomijając zupełnie krok włączenie obsługi <i>ENGINE=SPHINX</i> przez bazę danych.</p>

<p align="justify">Dodatkowy engine (jak choćby <i>MyISAM</i>, <i>InnoDB</i>, <i>Memory</i> itd. ) dla baz danych z rodziny MySQL (<i>MySQL</i>, <i>MariaDB</i>, <i>Percona Server</i>) dostarczany jest w postaci pluginu:</p>

<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="1" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<p>Jeśli instalacja pluginu przebiegła pomyślnie, na liście dostępnych silników powinien pojawić się SPHINX:</p>

<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="3-16" data-gist-highlight-line="12" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<p align="justify">Następnie możemy przystąpić do utworzenia tabeli z <i><b>ENGINE=SPHINX</b></i> i rozpocząć <i>full-text search</i> zadając klasyczne zapytania SQL. Niestety w przypadku Percona-Server, nie wszystko jest takie proste...</p>

<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="18-19" data-gist-highlight-line="19" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<p align="justify">Powyższy błąd spowodowany jest tym, że plugin do obsługi <i>SphinxSE</i> nie jest dostarczany razem z <i><b>Percona Server</b></i> (posiadają własną obsługę <i>FTS</i>), zatem konieczne jest przygotowanie takiej biblioteki we własnym zakresie.</p>

<p>Procedura kompilacji pluginu wygląda następująco:<br />

<ol>
<li>przygotowanie katalogu roboczego<br /><br /></li>
<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="21" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<li>pobranie źródeł Percona-Server (wersja zgodną z tą z której korzystamy) oraz ich rozpakowanie<br /><br /></li>
<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="21-35" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<li>pobranie źródeł SphinxSearch oraz ich rozpakowanie<br /><br /></li>
<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="37-49" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code> 

<li>kopiowanie źródeł pluginu do obsługi SphinxSE do Percona-Server<br /><br /></li>
<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="51-52" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<li>kompilacja źródeł Percony i wygenerowanie biblioteki <i>ha_sphinx.so</i><br /><br /></li>
<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="54-55" data-gist-highlight-line="55" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<li>kopiowanie biblioteki do docelowej lokalizacji oraz instalacja pluginu<br /><br /></li>
<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="57-62" data-gist-highlight-line="1" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>
</ol></p>

<p align="justify">Przedstawiona powyżej procedura bardzo dobrze sprawdziła się w przypadku środowiska <i>Mac OS X Yosemite</i>, ale niestety problemy
wystąpiły w <i>Ubuntu 14.04</i> (Percona-Server zainstalowany za pomocą <i>apt-get</i>):</p>

<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="62-63" data-gist-highlight-line="63" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<p align="justify">Analiza tego błędu i fachowych porad doprowadziła mnie do przyczyny - plugin trzeba skompilować z dokładnie takimi flagami z jakimi przygotowana została dostarczona dystrybucja naszej wersji bazy danych. Aby móc "podejrzeć" parametry kompilacji konieczne jest pobranie źródeł</p>

<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="65" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<p>oraz wyszukiwanie parametrów kompilacji (cmake) w pliku percona-server-{$VERSION}/debian/rules</p>

<p align="justify">Wracając do naszej procedury kompilacji, kroki 1-4 są identyczne, natomiast w kroku 5 wykonujemy polecenie cmake z takimi parametrami z jakimi została skompilowana nasza baza danych, np.</p>

<code data-gist-id="fbb4113f6bffd187706e" data-gist-line="67-68" data-gist-highlight-line="67" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<p>Krok 6 jest identyczny tj. kopiowanie biblioteki a następnie instalacja pluginu.</p>

<p align="justify">Generalnie, włączenie obsługi <i><b>SphinxSE</b></i> jest bardzo proste. Jednak, w szczególnych przypadkach, może wymagać nieco więcej wysiłku (przygotowanie pluginu we własnym zakresie). Niemniej uważam, że i tak to jest stosunkowo niewielki koszt biorąc pod uwagę bardzo duże możliwości oferowane przez Sphinx Storage Engine oraz niski próg wejścia i mały zakres wprowadzonych zmian w bazowej wersji naszej aplikacji.</p> 

<p>Przydatne linki:<br />

<ul>
<li><a href="https://mariadb.com/kb/en/mariadb/about-sphinxse/" target="_blank">https://mariadb.com/kb/en/mariadb/about-sphinxse/</a></li>
<li><a href="http://sysmagazine.com/posts/161461/" target="_blank">http://sysmagazine.com/posts/161461/</a></li>
<li><a href="https://trac.macports.org/ticket/45136" target="_blank">https://trac.macports.org/ticket/45136</a></li>
<li><a href="http://www.percona.com/doc/percona-server/5.6/installation/apt_repo.html" target="_blank">http://www.percona.com/doc/percona-server/5.6/installation/apt_repo.html</a></li>
<li><a href="http://www.digincore.org/index.php/blogi-razrabotchikov/entry/sphinxse-percona-mysql-ubuntu-debian" target="_blank">http://www.digincore.org/index.php/blogi-razrabotchikov/entry/sphinxse-percona-mysql-ubuntu-debian</a></li>
<li><a href="https://github.com/dragolabs/dpkg-sphinx-se" target="_blank">https://github.com/dragolabs/dpkg-sphinx-se</a></li>
<li><a href="https://github.com/ruhllatio/dpkg-sphinx-se" target="_blank">https://github.com/ruhllatio/dpkg-sphinx-se</a></li>
<li><a href="https://github.com/johnmarkg/percona-cluster-with-sphinx" target="_blank">https://github.com/johnmarkg/percona-cluster-with-sphinx</a></li>
<li><a href="https://github.com/nZEDb/nZEDb/tree/master/misc/sphinxsearch" target="_blank">https://github.com/nZEDb/nZEDb/tree/master/misc/sphinxsearch</a></li>
<li><a href="http://forums.nzedb.com/index.php?topic=1755.0" target="_blank">http://forums.nzedb.com/index.php?topic=1755.0</a></li>
<li><a href="http://www.codefromaway.net/2012/02/setting-up-percona-galera-and-sphinxse.html" target="_blank">http://www.codefromaway.net/2012/02/setting-up-percona-galera-and-sphinxse.html</a></li>
<li><a href="http://www.nicovs.be/install-mysql-with-sphinx-search-engine-support/" target="_blank">http://www.nicovs.be/install-mysql-with-sphinx-search-engine-support/</a></li>
<li><a href="http://forums.mysql.com/read.php?94,260436,260436" target="_blank">http://forums.mysql.com/read.php?94,260436,260436</a></li>
<li><a href="https://mariadb.com/kb/en/mariadb/sphinx-status-variables/" target="_blank">https://mariadb.com/kb/en/mariadb/sphinx-status-variables/</a></li>
<li><a href="http://sphinxsearch.com/forum/view.html?id=10238" target="_blank">http://sphinxsearch.com/forum/view.html?id=10238</a></li>
<li><a href="http://sphinxsearch.com/forum/view.html?id=10017" target="_blank">http://sphinxsearch.com/forum/view.html?id=10017</a></li>
<li><a href="http://sphinxsearch.com/forum/view.html?id=6862" target="_blank">http://sphinxsearch.com/forum/view.html?id=6862</a></li>
</ul>
</p>

