<p align="justify">Podstawą funkcjonowania rozwiązań wykorzystujących silniki wyszukiwania pełnotekstowego, takich jak np. <b>SphinxSearch</b>, jest obecność danych w indeksie. Sphinx umożliwia indeksowanie bezpośrednio z bazy bądź wykorzystując dedykowany format XML - <b>xmlpipe2</b>. Pierwsze rozwiązanie charakteryzuje wysoka wydajność, drugie z kolei pozwala na większą elastyczność i dostosowanie indeksowanych danych wedle potrzeb. W przypadku, gdy dane do indeksu trafiają z jednego źródła danych, zazwyczaj naturalnym wyborem jest pierwszy z wymienionych sposobów. Czy w przypadku wielu źródeł także wybierzemy to rozwiązanie?</p>

<p align="justify">Jeśli także w tym przypadku zdecydujemy się na indeksowanie danych prosto z bazy, wystarczy zdefiniować poszczególne źródła (odrębne sekcje <i>source</i>) oraz podpiąć je do wybranego indeksu. Należy jednak pamiętać o zachowaniu unikalności identyfikatorów dokumentów. Przykładowym rozwiązaniem tego problemu może być postępowanie według następującego wzorca: dla pierwszego źródła przypisujemy identyfikatory z przedziału <i>1</i> do <i>1M</i>, dla drugiego <i>1M+1</i> do <i>2M</i>, kolejnego <i>2M+1</i> - <i>3M</i> itd. Ale co w przypadku, gdy jedno ze źródeł będzie zawierało więcej niż 1M dokumentów? Dodatkowo planując strukturę indeksu musimy zadbać o to, aby znalazło się tam pole przechowujące rzeczywisty identyfikator (klucz) dokumentu, np. doc_id, tak aby można było skojarzyć znaleziony dokument z danym rekordem ze źródła danych.</p> 

<p align="justify">Przed podjęciem decyzji o wyborze tego rozwiązania, warto rozważyć jeszcze jedną kwestię - jak często zmienia się lista źródeł, z których będziemy pobierali dane? Usunięcie bądź dodanie kolejnego źródła będzie skutkowało wprowadzeniem zmian w konfiguracji (<i>sphinx.conf</i>), ponownym uruchomieniem procesu Sphinxa (<i>searchd</i>) oraz załadowaniem wszystkich indeksów (jeśli flaga <i>preopen</i> została włączona). Zatem częsta zmiana źródeł, gdy rozmiar zaindeksowanych danych jest znaczący, może być kosztowna. Natomiast wybierając drugi sposób dostarczania danych dla indeksera tj. <i>xmlpipe2</i> dynamika zmian źródeł danych nie wpływa na stabilność oraz wydajność naszego systemu.</p>

<p align="justify">Oczywiście nadal powinniśmy zapewnić unikalność identyfikatorów dokumentów oraz warto przechowywać w indeksie wewnętrzny identyfikator dokumentu (doc_id). Jednak dodanie nowego źródła nie będzie wymagało zmian w konfiguracji oraz restartu procesu Sphinxa. Wystarczy, że skrypt generujący indeksowane dane w formacie xmlpipe2 obsłuży zmianę listy źródeł danych. Co więcej, wybierając to rozwiązanie możemy dowolnie modyfikować indeksowane dane, np. konwersja polskich znaków diakrytycznych na ich odpowiedniki "bez ogonków", zastępowanie wybranych identyfikatorów pełnymi (słownikowymi) nazwami, np. coutry_code = 1 - Poland itd. Dodatkowo nie jesteśmy ograniczani do pobierania danych wyłącznie z bazy danych. Implementując skrypt generujący dane w formacie XML możemy pobierać dane także ze źródeł zwracających dane w formacie XML (np. RSS), JSON, dane z innych usług sieciowych (np. web service) itd.</p>

Przykładowa konfiguracja źródła generowanego z wykorzystaniem <i>xmlpipe2</i>:<br /><br />

<code data-gist-id="b4794ae38b2ad7ced9d2" data-gist-line="1-5,33-49" data-gist-highlight-line="35,36,47" data-gist-hide-footer="true" data-gist-hide-line-numbers="true"></code>

<p align="justify">Wydawać by się mogło, że xmlpipe2 jest rozwiązaniem idealnym, ale tak nie jest. Indeksowanie danych w ten sposób jest dużo wolniejsze niż w przypadku bezpośredniego pobierania z bazy danych. Niemniej, nadal jest dość wydajne. Dodatkowo xmlpipe2 posiada ograniczenie co do rozmiaru danych dla pojedynczego pola (<i>max_xmlpipe2_field</i>) oraz typowe ograniczenia formatu XML m.in. konieczność escape'owania znaków specjalnych, np. <, &.</p>

<p align="justify">Podsumowując, Sphinx umożliwia bardzo wydajne indeksowanie bezpośrednio z bazy danych oraz nieco mniej wydajny, za to elastyczny format xmlpipe2. Żaden ze wspomnianych formatów nie zapewnia wymagania unikalności identyfikatorów indeksowanych dokumentów (w przypadku indeksowania z wielu źródeł), ale każdy z nich daje inne możliwości. Wybór rozwiązania (bezpośrednie indeksowanie z bazy vs xmlpipe2) powinniśmy dostosować każdorazowo do projektowanego systemu.</p>

<p>Przydatne linki:<br />
<ul>
<li><a href="http://jetpackweb.com/blog/2009/08/16/sphinx-xmlpipe2-in-php-part-i/" target="_blank">http://jetpackweb.com/blog/2009/08/16/sphinx-xmlpipe2-in-php-part-i/</a></li>
<li><a href="http://sphinxsearch.com/forum/view.html?id=1215" target="_blank">http://sphinxsearch.com/forum/view.html?id=1215</a></li>
<li><a href="http://sphinxsearch.com/wiki/doku.php?id=sphinx_xmlpipe2_tutorial2" target="_blank">http://sphinxsearch.com/wiki/doku.php?id=sphinx_xmlpipe2_tutorial2</a></li>
<li><a href="http://sphinxsearch.com/forum/view.html?id=3913" target="_blank">http://sphinxsearch.com/forum/view.html?id=3913</a></li>
<li><a href="http://www.ivinco.com/blog/scripting-in-sphinx-config/" target="_blank">http://www.ivinco.com/blog/scripting-in-sphinx-config/</a></li>
</ul>

